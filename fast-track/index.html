<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- SEO Meta Tags -->
    <title>Six Continents Challenge - Win 150,000 Turkish Airlines Miles | Travel Contest Game</title>
    <meta name="description" content="Join the Six Continents Challenge! Solve riddles, unlock stages, and win up to 150,000 Turkish Airlines Miles. Follow Joel's 16-day journey across 6 continents in this interactive travel contest game.">
    <meta name="keywords" content="travel contest, Turkish Airlines miles, Six Continents Challenge, travel game, riddles, contest, win miles, travel competition, interactive game">
    <meta name="author" content="The Accidental Retiree">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://theaccidentalretiree.app/">
    
    <!-- Favicons -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#e60000">
    <meta name="msapplication-TileColor" content="#e60000">
    <meta name="theme-color" content="#e60000">
    
    <link rel="icon" href="https://public-frontend-cos.metadl.com/mgx/img/favicon.png" type="image/png">
    <link rel="stylesheet" href="/styles.css">
</head>

<body>
    <div id="global-toast" class="global-toast hidden">
        <p id="global-toast-message"></p>
    </div>
    
    <!-- Landing Page -->
    <div id="landingPage" class="landing-page">
        <div class="landing-hero">
            <div class="landing-tagline">Six Continents Challenge</div>
            <h1 class="landing-title">Ready to Win<br>150,000 Miles?</h1>
            <p class="landing-subtitle">Follow our journey. Solve riddles. Claim your prize.</p>

            <div class="landing-features">
                <div class="landing-feature">
                    <span class="landing-feature-icon">üîç</span>
                    <div class="landing-feature-text">Solve Clues</div>
                </div>
                <div class="landing-feature">
                    <span class="landing-feature-icon">üîì</span>
                    <div class="landing-feature-text">Unlock Stages</div>
                </div>
                <div class="landing-feature">
                    <span class="landing-feature-icon">‚úàÔ∏è</span>
                    <div class="landing-feature-text">Win Miles</div>
                </div>
            </div>

            <div class="prize-highlight">Win 150,000<br>Turkish Airlines Miles</div>

            <button id="fastTrackBtn" class="play-game-btn">FAST-TRACK ACCESS TO STAGE 5 üöÄ</button>
        </div>

        <!-- Player Status Card (Hidden by default) -->
        <section id="player-status" class="player-status-card hidden">
            <div class="player-status-label">Your Game Status</div>
            <h2 class="player-status-headline">Welcome back, <span id="playerName"></span></h2>
            <p class="player-status-subline">You're currently on Stage <span id="playerCurrentStage"></span> of 16</p>
            <button id="playerContinueBtn" class="player-continue-btn">Continue where you left off</button>
        </section>

        <!-- FOOTER SECTION -->
        <footer class="app-footer">
            <div class="footer-links">
                <a href="#" id="howToPlayLink">‚ùì How to Play the Game?</a>
                <span class="footer-separator">‚Ä¢</span>
                <a href="#" id="termsLink">‚öñÔ∏è Terms & Conditions</a>
            </div>
        </footer>
    </div>

    <!-- Auth Modal -->
    <div id="auth-modal" class="auth-modal">
        <div class="auth-modal-content">
            <div class="auth-header">
                <h2 id="auth-title">Join the Game!</h2>
                <button class="auth-close" onclick="authUI.closeModal()">&times;</button>
            </div>
            <div class="auth-tabs">
                <button class="auth-tab active" onclick="authUI.showTab('signup')">Sign Up</button>
                <button class="auth-tab" onclick="authUI.showTab('signin')">Sign In</button>
            </div>
            <div id="auth-signup" class="auth-form active">
                <form onsubmit="authUI.handleSignUp(event)">
                    <input type="email" id="signup-email" placeholder="Email" required>
                    <input type="password" id="signup-password" placeholder="Password (min 6 characters)" required minlength="6">
                    <input type="password" id="signup-password-confirm" placeholder="Confirm password" required minlength="6">
                    <button type="submit" class="auth-btn primary">Create Account & Start Playing</button>
                </form>
            </div>
            <div id="auth-signin" class="auth-form">
                <form onsubmit="authUI.handleSignIn(event)">
                    <input type="email" id="signin-email" placeholder="Email" required>
                    <input type="password" id="signin-password" placeholder="Password" required>
                    <button type="submit" class="auth-btn primary">Sign In</button>
                </form>
                <p class="auth-link">
                    <a href="#" onclick="authUI.showForgotPassword()">Forgot your password?</a>
                </p>
            </div>
            <div id="auth-forgot" class="auth-form">
                <p>Enter your email address and we'll send you a link to reset your password.</p>
                <form onsubmit="authUI.handleForgotPassword(event)">
                    <input type="email" id="forgot-email" placeholder="Email" required>
                    <button type="submit" class="auth-btn primary">Send Reset Link</button>
                </form>
                <p class="auth-link">
                    <a href="#" onclick="authUI.showTab('signin')">Back to Sign In</a>
                </p>
            </div>
            <div id="auth-message" class="auth-message"></div>
        </div>
    </div>

    <!-- Fast Track (Email Capture) Modal -->
    <div id="lead-modal" class="auth-modal">
      <div class="auth-modal-content">
        <div class="auth-header">
          <h2 id="lead-title">Skip ahead. We won't judge.</h2>
          <button class="auth-close" onclick="leadUI.closeModal()">&times;</button>
        </div>

        <div class="auth-form active" style="margin-top: 10px;">
          <p class="lead-subhead">
            Enter your email and we'll send you the answers to the first 4 stages so you can start on Stage 5.
          </p>

          <form onsubmit="leadUI.handleLeadSubmit(event)">
            <input type="email" id="lead-email" placeholder="Email" required>
            <button type="submit" class="auth-btn primary">Start Here ‚Üí</button>
          </form>

          <p class="lead-trust">No spam. No nonsense. Unsubscribe anytime.</p>

          <div id="lead-message" class="auth-message"></div>
        </div>
      </div>
    </div>

    <!-- How to Play Modal -->
    <div id="howToPlayModal" class="info-modal">
        <div class="info-modal-content">
            <div class="info-modal-header">
                <h2 class="info-modal-title">‚ú® How to Play the 6-Continent Challenge Giveaway and WIN</h2>
                <button class="info-modal-close" onclick="howToPlayModal.close()">‚úñ</button>
            </div>
            <div class="info-modal-body">
                <ol>
                    <li>Watch Joel's video for each stage</li>
                    <li>Listen to 3 clues about a specific place</li>
                    <li>Guess the answer (a location or landmark)</li>
                    <li>Progress through all 16 stages</li>
                    <li>Win prizes as you advance!</li>
                </ol>
                <p style="margin-top: 15px;">
                    üìú See full <a onclick="howToPlayModal.close(); termsModal.open();">Terms & Conditions ‚Üí</a>
                </p>
            </div>
        </div>
    </div>

    <!-- Terms Modal -->
    <div id="termsModal" class="info-modal">
        <div class="info-modal-content">
            <div class="info-modal-header">
                <h2 class="info-modal-title">‚öñÔ∏è Terms & Conditions</h2>
                <button class="info-modal-close" onclick="termsModal.close()">‚úñ</button>
            </div>
            <div class="info-modal-body">
                <p><strong>The Six Continents Challenge is a contest organized by The Accidental Retiree.</strong></p>
                <p>By participating, you agree to these terms and contest rules.</p>
                <p><strong>Eligibility:</strong> Open to residents of eligible countries (varies by local law).</p>
                <p><strong>How to Enter:</strong> Sign up, solve riddles, progress through stages.</p>
                <p><strong>Prize:</strong> Up to 150,000 Turkish Airlines Miles to the Grand Prize winner.</p>
                <p><strong>No purchase necessary.</strong> Contest runs through June 30, 2026.</p>
                <p><em>For complete rules, contact support.</em></p>
            </div>
        </div>
    </div>

    <script src="/config.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script type="module" src="/marketing.js"></script>
    <script>
        // Simple modal handler
        const howToPlayModal = {
            open: () => {
                const modal = document.getElementById('howToPlayModal');
                if (modal) modal.style.display = 'flex';
            },
            close: () => {
                const modal = document.getElementById('howToPlayModal');
                if (modal) modal.style.display = 'none';
            }
        };

        const termsModal = {
            open: () => {
                const modal = document.getElementById('termsModal');
                if (modal) modal.style.display = 'flex';
            },
            close: () => {
                const modal = document.getElementById('termsModal');
                if (modal) modal.style.display = 'none';
            }
        };
    </script>

    <script>
      // --- Fast Track Lead Capture ---
      // Assumes:
      // - config.js sets SUPABASE_URL + SUPABASE_ANON_KEY (common pattern)
      // - supabase-js is loaded
      // If your script.js already creates a global client, we will reuse it.

      function getSupabaseClientSafe() {
        // Try to reuse an existing client if your app already sets one.
        if (window.supabaseClient) return window.supabaseClient;

        // Common naming patterns
        if (window.supabase && window.SUPABASE_URL && window.SUPABASE_ANON_KEY) {
          try {
            window.supabaseClient = window.supabase.createClient(window.SUPABASE_URL, window.SUPABASE_ANON_KEY);
            return window.supabaseClient;
          } catch (e) {}
        }

        // Some apps expose config differently:
        if (window.supabase && window.CONFIG?.SUPABASE_URL && window.CONFIG?.SUPABASE_ANON_KEY) {
          try {
            window.supabaseClient = window.supabase.createClient(window.CONFIG.SUPABASE_URL, window.CONFIG.SUPABASE_ANON_KEY);
            return window.supabaseClient;
          } catch (e) {}
        }

        return null;
      }

      function setLeadMessage(msg, isError = false) {
        const el = document.getElementById('lead-message');
        if (!el) return;
        el.textContent = msg;
        el.style.display = 'block';
        el.style.marginTop = '12px';
        el.style.color = isError ? '#ff4d4d' : '';
      }

      const leadUI = {
        openModal: () => {
          const modal = document.getElementById('lead-modal');
          if (modal) modal.style.display = 'flex';
          setLeadMessage('');
          const email = document.getElementById('lead-email');
          if (email) setTimeout(() => email.focus(), 50);
        },
        closeModal: () => {
          const modal = document.getElementById('lead-modal');
          if (modal) modal.style.display = 'none';
        },
        goToSignIn: (e) => {
          e.preventDefault();
          leadUI.closeModal();
          // Your existing auth modal behavior:
          const authModal = document.getElementById('auth-modal');
          if (authModal) authModal.style.display = 'flex';
          if (window.authUI?.showTab) window.authUI.showTab('signin');
        },
        handleLeadSubmit: async (e) => {
          e.preventDefault();

          const emailEl = document.getElementById('lead-email');
          const email = (emailEl?.value || '').trim().toLowerCase();

          if (!email || !email.includes('@')) {
            setLeadMessage('Please enter a valid email.', true);
            return;
          }

          // UX: disable button while submitting
          const btn = e.target.querySelector('button[type="submit"]');
          const originalText = btn?.textContent;
          if (btn) {
            btn.disabled = true;
            btn.textContent = 'Sending‚Ä¶';
          }

          try {
            // Save locally (optional)
            localStorage.setItem('fastTrackLeadEmail', email);

            const client = getSupabaseClientSafe();
            if (!client) {
              setLeadMessage('Supabase client not available. Check config.js loading order.', true);
              return;
            }

            // 1) Insert lead into a table (create this table + RLS policy below)
            const { error } = await client
              .from('marketing_leads')
              .insert([{
                email,
                source: 'fast-track',
                page: window.location.pathname,
                created_at: new Date().toISOString()
              }]);

            // If duplicate email exists, you can either allow duplicates or enforce unique email.
            // If unique constraint triggers, treat it like success.
            if (error) {
              const msg = (error.message || '').toLowerCase();
              const dup = msg.includes('duplicate') || msg.includes('unique');
              if (!dup) throw error;
            }

            // 2) OPTIONAL: Trigger autoresponder via Edge Function (recommended)
            // Create an Edge Function named "send-fasttrack" later.
            // If it doesn't exist yet, this will fail silently (but lead is already captured).
            try {
              await fetch('/functions/v1/send-fasttrack', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email })
              });
            } catch (_) {}

            // Success state
            setLeadMessage('‚úÖ Check your inbox ‚Äî your Stage 1‚Äì4 answers are on the way.');
            if (btn) btn.textContent = 'Sent ‚úÖ';

            // Mark fast-track active and store email
            localStorage.setItem('fastTrackActive', 'true');
            localStorage.setItem('fastTrackLeadEmail', email);
            // Start them at stage 1 (or whatever your app uses)
            localStorage.setItem('fastTrackMaxStage', '4');

            // Redirect to fast-track play after successful email validation
            setTimeout(() => {
              window.location.href = '/fast-track/play';
            }, 600);

          } catch (err) {
            console.error('Lead submit error:', err);
            setLeadMessage('Something went wrong. Please try again.', true);
          } finally {
            if (btn) {
              btn.disabled = false;
              btn.textContent = originalText || 'Send My Head Start ‚Üí';
            }
          }
        }
      };

      // Wire the new CTA
      document.addEventListener('DOMContentLoaded', () => {
        const btn = document.getElementById('fastTrackBtn');
        if (btn) btn.addEventListener('click', leadUI.openModal);

        // Close modal if user clicks outside the content
        const modal = document.getElementById('lead-modal');
        if (modal) {
          modal.addEventListener('click', (e) => {
            if (e.target === modal) leadUI.closeModal();
          });
        }
      });
    </script>
</body>

</html>
